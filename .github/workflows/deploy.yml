name: Deploy to Replicate

on:
  workflow_dispatch:
    inputs:
      model_name:
        description: 'Model name (e.g., scribie/parakeet-tdt-speaker-diarization)'
        required: false
        default: 'scribie/parakeet-tdt-speaker-diarization'
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy to Replicate
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install latest Cog
        run: |
          python -m pip install --upgrade pip
          pip install cog==0.9.8
          echo "Cog installation complete"
          which cog || echo "Cog not in PATH, checking python -m cog"
          python -m cog --version || pip show cog

      - name: Push to Replicate
        env:
          REPLICATE_API_TOKEN: ${{ secrets.REPLICATE_CLI_AUTH_TOKEN }}
        run: |
          echo "ðŸš€ Deploying to Replicate..."
          python -m cog push r8.im/${{ inputs.model_name || 'scribie/parakeet-tdt-speaker-diarization' }} 